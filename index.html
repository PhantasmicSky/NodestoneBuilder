<!DOCTYPE HTML>
<html>
    <head>
        <title>Nodestone Solver</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
        <link rel="stylesheet" href="style.css">
        <link rel="nodestone icon" type="image/x-icon" href="favicon.ico">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>     
        <script type="text/javascript" src="control.js" defer></script>
        <script async src="opencv.js" type="text/javascript"></script>
    </head>
    <body onload="loadJSON()">
        <div class="container">
            <div class="row">
              <div class="col-12 mt-4" style="text-align:center">
                <h1 style="text-align:center">Nodestone Builder</h1>
                <h5 style="text-align:center">By AethericSky of GMS Kronos</h5>
              </div>
              <div class="col-12 mt-4">
                <table>
                  <thead>
                    <tr>
                      <th>Select Job: </th>
                      <th><select name="jobSelect" id="jobSelect" onchange="skillChange()">
                        <option value="">Select Job</option></th>
                      </select>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td id="openCVStatus">OpenCV is Loading</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <br/>
            <div class="container" id="normalOperation" name="hiddenObj">
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section1')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Tri-Node Skill Select</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-up-square-fill" style="line-height: inherit;" id="section1Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse show" id="section1">
                <div class="row" id="skillPicker">
                  <div class="col-12 mt-2">
                    <table class="table table-bordered" id="pickerNode">
                      <thead>
                        <tr>
                          <th scope="col" colspan="5">Select Skills</th>
                        </tr>
                      </thead>
                      <tbody id="skillOption1">

                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <br/>
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section1p5')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Tri-Node Creator</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-up-square-fill" style="line-height: inherit;" id="section1p5Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse show" id="section1p5">
                <div class="row" id="skillPicker2">
                  <div class="col-12 mt-2 table-responsive">
                    <table class="table table-bordered" id="pickerTriNode">
                      <thead>
                        <tr>
                          <th scope="col" colspan="20">Select Skills</th>
                        </tr>
                        <tr>
                          <th scope="col">Skill</th>
                          <th scope="col">1</th>
                          <th scope="col">2</th>
                          <th scope="col">3</th>
                          <th scope="col">Skill</th>
                          <th scope="col">1</th>
                          <th scope="col">2</th>
                          <th scope="col">3</th>
                          <th scope="col">Skill</th>
                          <th scope="col">1</th>
                          <th scope="col">2</th>
                          <th scope="col">3</th>
                          <th scope="col">Skill</th>
                          <th scope="col">1</th>
                          <th scope="col">2</th>
                          <th scope="col">3</th>
                          <th scope="col">Skill</th>
                          <th scope="col">1</th>
                          <th scope="col">2</th>
                          <th scope="col">3</th>
                        </tr>
                      </thead>
                      <tbody id="skillOption1p5">

                      </tbody>
                    </table>
                    <table class="table" id="pickerTriPreview">
                      <thead>
                        <tr>
                          <th>Current Selection Preview</th>
                          <th class="widthCreate2" id="previewPhoto">                                  
                            <img src="Images/MapleDivider.png" name="firstSlice" id="prev1a"/>
                            <img src="Images/MapleDivider.png" name="secondSlice" id="prev2a"/>
                            <img src="Images/MapleDivider.png" name="thirdSlice" id="prev3a"/>
                            <img src="Images/MapleDivider.png" name="divider"/>
                          </th>
                          <th id="textSel1"></th>
                          <th id="textSel2"></th>
                          <th id="textSel3"></th>
                          <th>
                            <button type="button" class="btn btn-primary" onclick="addNodestone2()">Add Nodestone</button>
                          </th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
              </div>
              <br/>
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section2')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Nodestone Collection</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-up-square-fill" style="line-height: inherit;" id="section2Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse show" id="section2">
                <div class="row">
                  <div id="rightCreator">
                    <table class="table" id="nodeList" name="sortable">
                        <thead>
                            <tr>
                              <th scope="col">Trinode Skills</th>
                              <th scope="col"> </th>
                              <th scope="col">Node Score</th>
                              <th scope="col">Add</th>
                              <th scope="col">Delete</th>
                            </tr>
                          </thead>
                          <tbody>
                          </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <br/>
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section3')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Current Trinode Setup</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-up-square-fill" style="line-height: inherit;" id="section3Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse show" id="section3">
                <div class="row">
                  <div class="col-6" id="leftCombo">
                    <table class="table" id="nodeCombo" name="sortable">
                      <thead>
                          <tr>
                            <th scope="col" colspan="2">Trinode Skills</th>
                            <th scope="col">Delete</th>
                          </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                  <div class="col-6" id="rightCombo">
                    <table class="table" id="controlCenter">
                      <thead>
                        <tr>
                          <th scope="col" colspan="3">Trinode Builder Options</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td scope="col"><button type="button" class="btn btn-primary" id="autoBuild" onclick="printCombination()">Auto Build [Sync]</button></td>
                          <td scope="col"><button type="button" class="btn btn-primary" id="autoBuild" onclick="buildPerfectTri()">Auto Build [Async]</button></td>
                          <td scope="col"><button type="button" class="btn btn-primary" id="autoBuild" onclick="autoButtonClick3()">Unequip All Trios</button></td>
                        </tr>
                        <tr>
                          <td scope="col">Number of Copies per Skill</td>
                          <td scope="col" colspan="2" class="centralizer">
                            <select name="copyNumber" id="copyNumber" onchange="numberChange()">
                              <option value=2>2</option>
                              <option value=3>3</option>
                              <option value=4>4</option>
                              <option value=5>5</option>
                              <option value=6>6</option>
                            </select>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <table class="table" id="nodeStatistics1">
                      <thead>
                          <tr>
                            <th scope="col" colspan="2">Node Combination Statistics</th>
                          </tr>
                      </thead>
                      <tbody>
                          <tr>
                            <td scope="col"><strong>Total Skills Selected</strong></td>
                            <td scope="col" name="skillCounter"></td>
                          </tr>
                          <tr>
                            <td scope="col"><strong># of Slots(If All Perfect Trios)</strong></td>
                            <td scope="col" name="bestOutcome"></td>
                          </tr>
                          <tr>
                            <td scope="col"><strong>Node Slots Used</strong></td>
                            <td scope="col" name="nodeUsage"></td>
                          </tr>
                          <tr>
                            <td scope="col"><strong>Node Efficiency</strong></td>
                            <td scope="col" name="nodeEfficiency"></td>
                          </tr>
                      </tbody>
                    </table>
                    <table class="table" id="nodeStatistics2" name="sortable">
                      <thead>
                          <tr>
                            <th scope="col">Skill</th>
                            <th scope="col">Selected</th>
                            <th scope="col">Occupied Slots</th>
                          </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="container" id="helpOperation" name="noOp">
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section35')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Help</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-down-square-fill" style="line-height: inherit;" id="section35Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse" id="section35">
                <h3>How to use</h3>
                <hr/>
                <h5>1. Select the job you want to build your tri-nodes</h5>
                <p>Click the dropdown box and select your class.</p>
                <div class="container mx-auto text-center">
                  <img src="Images/step1.PNG" class="img-fluid" alt="Select your class">
                </div>
                <h5>2. Select the skills you need to build your tri-nodes around</h5>
                <p>Click on the skills you want to select. Those highlighted in blue are currently selected.</p>
                <div class="container mx-auto text-center">
                  <img src="Images/step2.PNG" class="img-fluid" alt="Select your desired skills">
                </div>
                <h5>3. Create the tri-nodes you currently have.</h5>
                <p>Create your tri-nodes by clicking the corresponding column beside the skill icon based on its location in your trinode (1 being the leading skill). Upon clicking "Add Nodestone", the created nodestone will be added to the list below.</p>
                <div class="container mx-auto text-center">
                  <img src="Images/step3.PNG" class="img-fluid" alt="Recreate the tri-nodes you own">
                </div>
                <h6><b><u>Created Nodestone Collection Legend</b></u></h6>
                <div class="container mx-auto text-center">
                  <img src="Images/step32.PNG" class="img-fluid" alt="Nodestone Collection UI">
                </div>
                <ol>
                  <li>Shows the skills enhanced by the tri-node</li>
                  <li>Shows the tri-node skill image</li>
                  <li>Shows the Node Score</li>
                  <li>Adds the tri-node to the "equipped" tri-nodes list</li>
                  <li>Deletes the tri-node from the list (Available only when there are no tri-nodes equipped)</li>
                </ol>
                <h6><b><u>Node Score</b></u></h6>
                <p>To facilitate the user in building their tri-node set, Each tri-node is given a score that updates based on the current nodestones equipped.</p>
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Score</th>
                      <th scope="col">Meaning</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td scope="col">6</td>
                      <td scope="col">A Perfect Tri-Node</td>
                    </tr>
                    <tr>
                      <td scope="col">1-5</td>
                      <td scope="col">The Tri-Node will not fully contribute to your desired tri-node set (Some skills may not be part of your desired list of skills or two copies of some of the skill are already present in your currently equipped tri-nodes)</td>
                    </tr>
                    <tr>
                      <td scope="col">0</td>
                      <td scope="col">The Tri-Node contains no skill that is part of your desired skills to enhance</td>
                    </tr>
                    <tr>
                      <td scope="col">-1 (In Use)</td>
                      <td scope="col">The Tri-Node Is Currently Equipped</td>
                    </tr>
                    <tr>
                      <td scope="col">-1 (Leading Skill)</td>
                      <td scope="col">The Tri-Node's Leading Skill is already present in your currently equipped tri-nodes</td>
                    </tr>
                  </tbody>
                </table>
                <p><i>Tip: You can click the header (Trinode Skills, and Node Score) to sort the nodes in alphabetical order (A->Z or Z->A) or to sort the nodes based on their current node score (ascending or descending)</i></p>
                <h5>4. Equipped Nodes and Building your perfect trinode set</h5>
                <p>You may unequip nodes by clicking the "Remove" button beside the currently equipped nodes</p>
                <div class="container mx-auto text-center">
                  <img src="Images/step4.PNG" class="img-fluid" alt="Check and Unequip your tri-nodes">
                </div>
                <h6><b><u>Trinode Builder Options</u></b></h6>
                <p>While manually equipping and unequipping trinodes is possible, you may want to try letting the program build the set of perfect trinodes for you.</p>
                <div class="container mx-auto text-center">
                  <img src="Images/step42.PNG" class="img-fluid" alt="Trinode Builder Options">
                </div>
                <ol>
                  <li>Automatically builds perfect trinode set for you.</li>
                  <li>Automatically builds perfect trinode set for you. Same as Auto Build [Sync] but this delegates the building task to a web worker which should avoid browsers to Not Respond if there are too many nodes to build from.</li>
                  <li>Removes all equipped trinodes.</li>
                  <li>You may customize how many copies of each skill you would want in your trinode set (2-6)</li>
                </ol>
                <p><i>Tip: If you have perfect trinodes you want to incorporate in the build, equip them first before clicking Auto Build. Just press Ok to the alerts saying that the trinode is already equipped.</i></p>
                <h6><b><u>Node Statistics</b></u></h6>
                <div class="container mx-auto text-center">
                  <img src="Images/step43.png" class="img-fluid" alt="Node Statistics UI">
                </div>
                <ol>
                  <li>Shows how many skills were selected.</li>
                  <li>Gives an estimate of how many nodes it would take to most efficiently get 2 copies of each skill selected</li>
                  <li>Shows how many node slots are currently used</li>
                  <li>Shows how many node "skill slots"(3 per node) is used efficiently (i.e. The skill is selected the total copies of that skill in the equipped node slots do not exceed the number you specified)[Note: Only jobs that need "multiples of 3" amounts of boosted skills expect a 100% Node efficiency]</li>
                  <li>Gives a breakdown of each skill and how many times it has already appeared in the equipped nodes.</li>
                </ol>
                <p><i>Tip: You can click the header (Skill, Selected, Occupied Slots) to sort them in order</i></p>
                <h5>5. Saving and Loading</h5>
                <div class="container mx-auto text-center">
                  <img src="Images/step5.PNG" class="img-fluid" alt="Save and Load Nodelist">
                </div>
                <p>By clicking the "Generate Nodelist" button, you can generate a list of the nodestones you currently have. Be sure to save it somewhere.</p>
                <p>By pasting the generated text and clicking the "Load List" button, your nodes will automatically be loaded in.</p>
                <h5>6. Loading Nodestones via images or snips</h5>
                <div class="container mx-auto text-center">
                  <img src="Images/step6.png" class="img-fluid" alt="Load Nodes from Save String">
                </div>
                <p>You may now also load trinodes you have using in-game snips or images.</p>
                <p>Just use the snipping tool or screenshot the nodestone inventory from in-game. Ideally make sure to not include any skill nodes in the snip (this might, in rare cases, lead to false trinode creation). The program processes the images from top left to bottom right so if any skill node results in a false trinode, they should either be up top or at the very end of the nodelist. Do note that duplicate trinodes (where A = A, B = B, and C = C) would only appear once.</p>
                <p>Make sure that no filters are applied or that the image is scaled as this would affect the detection of trinodes in a photo.</p>
                <p>You may paste multiple images before clicking "Load via Photos" and the program will process them one after the other.</p>
                <p>If you want to remove a photo you uploaded, just click the photo you want to remove.</p>
                <p>Locked Trinodes should not pose a problem. If you do notice some issues, please try unlocking the trinodes and snap another photo.</p>
                <p>A sample uploaded snip is shown below.</p>
                <div class="container mx-auto text-center">
                  <img src="Images/step62.png" class="img-fluid" alt="Load Nodes from Photos">
                </div>
              </div>
            </div>
            <br/>
            <div class="container" id="saveLoadContainer" name="noOp">
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section4')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Save or Load Nodelist</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-up-square-fill" style="line-height: inherit;" id="section4Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse show" id="section4">
                <div class="row" style="padding-bottom:15px">
                  <div class="col-12" id="saveLoad">
                    <textarea id="saveLoadArea" rows="8"></textarea>
                    <br/>
                    <button type="button" class="btn btn-primary" onclick="genList()">Generate Nodelist</button>
                    <button type="button" class="btn btn-primary" onclick="loadList()">Load Nodelist</button>
                  </div>
                </div>
              </div>
            </div>
            <br/>
            <div class="container" id="nodePhotoLoader" name="hiddenObj">
              <nav class="navbar navbar-expand-sm bg-primary navbar-dark nav-fill w-100" onclick="divcollapse('section45')">
                <ul class="navbar-nav nav-fill w-100">
                  <li class="nav-item active">
                    <h3 style="text-align:left">Load Nodes from Photo</h3>
                  </li>
                  <li class="nav-item" style="text-align:right">
                    <i class="bi bi-caret-up-square-fill" style="line-height: inherit;" id="section45Arrow"></i>
                  </li>
                </ul>
              </nav>
              <div class="container-fluid border collapse show" id="section45">
                <div class="row" style="padding-bottom:15px">
                  <div class="col-12" id="photoLoadContainer">
                    <p>Snip or Copy the photo containing your ingame trinode and then click here and use Ctrl-V to paste your snips or image file. You can load multiple photos.</p>
                    <p>Ideally ensure that only trinode photos are present and not skill nodes as they may trigger false matches. Ensure that the photo is not scaled or filtered in any way.</p>
                    <p>Click the photo to remove them.</p>
                    <div class="col-12" id="uploadedPhotos" style="padding-bottom:15px"></div>
                    <button type="button" class="btn btn-primary" id="photoRead" onclick="readPhotos()">Load via Photos</button>
                  </div>
                </div>
              </div>
            </div>
            <br/>
            <div class="modal fade" id="whatsNewModal" tabindex="-1" role="dialog" aria-labelledby="versionNotes" aria-hidden="true">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Version Changes [Version 1.11]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <h2>New</h2>
                    <ul>
                      <li>Nodestones can now be loaded from in game screenshots or snips. Just make sure that the image only contains trinodes to limit the number of false positives. Photo should also not be scaled or filtered.<br/><strong>NOTE: If load from image returns 0 nodes even though there should be at least 1, try reloading the page. With the way OpenCV is loaded in this page, the 1st visit per session usually results in a failed load which gets fixed upon reloading the page.</strong></li>
                      <li>Added a green flash when a new trio is added manually to give users feedback that the trio has been added succesfully.</li>
                    </ul>
                    <hr>
                    <h2>Update</h2>
                    <ul>
                      <li>Angelic Buster's Skills and Skill Photos have been changed to match the remaster.</li>
                    </ul>
                    <h2>Fix</h2>
                    <ul>
                      <li>[2024-05-29] Loading from Photos not working (The known issue still stands but photo loading should now work).</li>
                    </ul>
                    <hr>
                    <p>Visit the <a href="https://github.com/PhantasmicSky/NodestoneBuilder/blob/main/CHANGELOG.md">Change Log</a> to check out the full and detailed list of changes.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="modalCookie(false)">Close</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="modalCookie(true)">Close until new update</button>
                  </div>
                </div>
              </div>
            </div>
            </br>
            <button type="button" class="btn btn-primary" id="versionInfo" data-toggle="modal" data-target="#whatsNewModal">Version Notes</button>
            <button type="button" class="btn btn-primary invisible" id="autoBuild" onclick="printCombination()">Auto Build</button>
            <button type="button" class="btn btn-primary invisible" id="autoBuild" onclick="buildPerfectTri()">Auto Build [Web Worker]</button>
            <button type="button" class="btn btn-primary invisible" onclick="checkVar()">Check Variables</button>
            <hr/>
            <div>
              <p class="text-center"><em>Last Updated: 2024-05-01</em></p>
            </div>
        </div>
    </body>
    <script type="text/javascript"> 
      var Module = {
      // https://emscripten.org/docs/api_reference/module.html#Module.onRuntimeInitialized
      onRuntimeInitialized() {
      document.getElementById('openCVStatus').remove();
      preLoad();
      }
  };</script>
</html>